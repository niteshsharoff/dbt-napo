version: 2

models:
  - name: training_funnel_metrics
    description: "Training & Socialisation funnel metrics aggregated by day."
    columns:
      - name: date
        description: "Aggregation date."
      - name: ad_spend
        description: "Ad spend sourced from growth_sales_by_channel where channel = 'pa_standalone'."
      - name: registrations
        description: "Number of customers in booking-service DB where source = 'pa_registrant'."
      - name: free_trials_started
        description: "Number of free trials started aggregated by day."
      - name: new_annual
        description: "Count of payment intents aggregated by day where payment_plan_type = 'year'."
      - name: new_monthly
        description: "Count of payment intents aggregated by day where payment_plan_type = 'month' and recurring_payment = false."
      - name: new_weekly
        description: "Count of payment intents aggregated by day where payment_plan_type = 'week' and recurring_payment = false."
      - name: recurring_monthly
        description: "Count of payment intents aggregated by day where payment_plan_type = 'month' and recurring_payment = true."
      - name: recurring_weekly
        description: "Count of payment intents aggregated by day where payment_plan_type = 'week' and recurring_payment = true."
      - name: new_revenue
        description: "Sum of payment amounts aggreated by day where recurring_payment = false."
      - name: recurring_revenue
        description: "Sum of payment amounts aggreated by day where recurring_payment = true."
      - name: other_revenue
        description: "Sum of payment amounts aggreated by day where stripe_customer_id and customer_uuid is null."

  - name: training_user_level_metrics
    description: "Training & Socialisation engagement metrics (cumulative)."
    latest_version: 1
    versions:
      - v: 1
    columns:
      - name: customer_uuid
        description: "Napo internal customer unique identifier."
      - name: email
        description: "Customer email address."
      - name: name
        description: "Customer full name."
      - name: customer_type
        description: "pa_standalone"
      - name: registration_date
        description: "Deprecated, to replaced by registration_at."
      - name: purchase_date
        description: "Deprecated, to replaced by first_payment_at."
      - name: registration_at
        description: "The timestamp the customer object is created in booking-service DB."
      - name: trial_start_date
        description: "The date the customer's Stripe trial started."
      - name: subscription_cancel_date
        description: "The date the customer's Stripe subscription was cancelled."
      - name: talk_to_trainer_sessions_booked
        description: "Number of 'call with a trainer' sessions booked"
      - name: sessions_scheduled
        description: "Number of sessions scheduled."
      - name: sessions_joined
        description: "Number of sessions joined."
      - name: sessions_attended
        description: "Number of sessions attended."
      - name: sessions_missed
        description: "Number of sessions missed."
      - name: sessions_cancelled
        description: "Number of sessions cancelled."
      - name: sessions_time_spent
        description: "Cumulative time spent across all sessions (in seconds)."
      - name: classes_scheduled
        description: "Number of classes scheduled, multiple sessions for the same class is only counted once."
      - name: classes_joined
        description: "Number of classes joined, multiple sessions for the same class is only counted once."
      - name: classes_attended
        description: "Number of classes attended, multiple sessions for the same class is only counted once."
      - name: classes_missed
        description: "Number of classes missed, multiple sessions for the same class is only counted once."
      - name: classes_cancelled
        description: "Number of classes cancelled, multiple sessions for the same class is only counted once."
      - name: videos_played
        description: "Total number of videos played (including re-watches)."
      - name: videos_completed
        description: "Total number of videos completed (including re-watches)."
      - name: first_class_attended
        description: "Name of the first class the customer attended."
      - name: first_class_attended_at
        description: "The timestamp of the first class the customer attended."
      - name: is_training_customer
        description: "Set to true if the customer has purchased a policy with Napo at any point in time."
      - name: is_insurance_customer
        description: "Set to true if the customer can be found in our booking database or via Stripe payments."
      - name: first_payment_at
        description: "First successful payment timestamp grouped by customer UUID."
      - name: last_payment_at
        description: "Last known successful payment timestamp grouped by customer UUID."
      - name: annual_payment_count
        description: "Number of successful annual payments paid."
      - name: monthly_payment_count
        description: "Number of successful monthly payments paid."
      - name: weekly_payment_count
        description: "Number of successful weekly payments paid."
